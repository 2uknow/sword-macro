# 원격 데스크톱 환경에서 매크로 사용 가이드

## 문제 상황
- 원격 컴퓨터: 듀얼 모니터 (4K x 2대)
- 로컬 컴퓨터: FHD 모니터
- 원격 데스크톱 접속/종료 시 해상도가 변경되는 문제

## 해결 방법

### 1. 초기 설정 (한 번만 수행)

#### 방법 A: 원격 컴퓨터에서 직접 설정
1. 원격 데스크톱으로 접속
2. 카카오톡을 **주 모니터(첫 번째 모니터)**로 이동
3. 좌표 설정 도구 실행:
   ```bash
   cd d:\dev\sword-macro
   python get_coordinates_pyautogui.py
   ```
4. 화면 지시에 따라 마우스를 움직이고 비율 확인
5. `rl\config.py` 파일 열기
6. 비율 값을 다음 형식으로 입력:
   ```python
   CHAT_OUTPUT_COORD_RATIO = (0.828, 0.489)  # 채팅 출력창
   CHAT_INPUT_COORD_RATIO = (0.838, 0.841)   # 채팅 입력창
   ```

### 2. 매크로 실행

#### 백그라운드 모드로 실행 (권장)
```bash
# start_macro.bat 더블클릭
# 또는 명령어로:
start_macro.bat
```

#### 일반 모드로 실행
```bash
python macro.py
```

### 3. 원격 데스크톱 종료
- 매크로가 실행 중인 상태에서 **원격 데스크톱 앱을 자유롭게 종료**할 수 있습니다
- 원격 컴퓨터에서 매크로는 계속 실행됩니다
- 해상도가 변경되어도 자동으로 조정됩니다

### 4. 매크로 종료

#### 원격 데스크톱으로 다시 접속 후:
```bash
# stop_macro.bat 더블클릭
# 또는
# 작업 관리자에서 pythonw.exe 종료
```

#### 직접 접속한 경우:
- F5 키: 정상 종료
- ESC 키: 긴급 종료
- Ctrl+C: 강제 종료

## 주요 개선 사항

### ✅ 비율 기반 좌표 시스템
- 해상도가 변경되어도 자동으로 올바른 위치 계산
- 원격/로컬 환경 모두 지원

### ✅ Fail-safe 예외 처리
- PyAutoGUI의 안전장치 오작동 방지
- 에러 발생 시 자동 재시도

### ✅ 좌표 안전성 검사
- 화면 범위를 벗어나는 좌표 자동 보정
- 화면 가장자리(50px) 영역 회피

### ✅ 백그라운드 실행 지원
- 콘솔 없이 실행
- 터미널 종료해도 계속 동작

## 문제 해결

### 좌표가 맞지 않는 경우
1. 카카오톡을 주 모니터로 이동
2. `get_coordinates_pyautogui.py` 다시 실행
3. 비율 재설정

### 매크로가 응답하지 않는 경우
1. 작업 관리자 열기 (Ctrl+Shift+ESC)
2. `pythonw.exe` 또는 `python.exe` 프로세스 종료
3. 매크로 재시작

### 원격 데스크톱 종료 후 에러 발생
- 정상적인 현상입니다
- 매크로가 자동으로 재시도하므로 기다리면 복구됩니다
- 해상도 변경이 완료되면 정상 동작합니다

## 조작키

- **F1**: 수동 강화
- **F2**: 수동 판매
- **F3**: AI 자동 모드 시작/중지
- **F4**: 규칙 기반 자동 모드 시작/중지
- **F5**: 매크로 종료 (통계 표시)
- **ESC**: 긴급 종료
